<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) & !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Motor Speed Control Hook | Mechatronics Project Site</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="/wp-content/themes/twentyeleven/style.css" />
<link rel="pingback" href="/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s.gravatar.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Mechatronics Project Site &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="Mechatronics Project Site &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Mechatronics Project Site &raquo; Motor Speed Control Hook Comments Feed" href="/project-3/quadcopter-software/motor-control/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='fancybox-css'  href='/wp-content/plugins/easy-fancybox/fancybox/jquery.fancybox-1.3.7.min.css?ver=1.5.7' type='text/css' media='screen' />
<link rel='stylesheet' id='jetpack_css-css'  href='/wp-content/plugins/jetpack/css/jetpack.css?ver=3.9.7' type='text/css' media='all' />
<!-- This site uses the Google Analytics by Yoast plugin v5.4.6 - Universal enabled - https://yoast.com/wordpress/plugins/google-analytics/ -->
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-28621799-2', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('require', 'displayfeatures');
	__gaTracker('send','pageview');

</script>
<!-- / Google Analytics by Yoast -->
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.2" />
<link rel="canonical" href="/project-3/quadcopter-software/motor-control/" />
<link rel='shortlink' href='http://wp.me/P2a9yP-95' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Fproject-3%2Fquadcopter-software%2Fmotor-control%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Fproject-3%2Fquadcopter-software%2Fmotor-control%2F&#038;format=xml" />
<link rel="stylesheet" type="text/css" href="/wp-content/plugins/wp-code-highlight/css/wp-code-highlight.css" media="screen" />

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Motor Speed Control Hook" />
<meta property="og:url" content="/project-3/quadcopter-software/motor-control/" />
<meta property="og:description" content="Aeroquad comes preconfigured with a variety of different motor controller libraries.  The latest version at the time of writing contains a library that takes advantage of the Uno&#8217;s ATMega 328…" />
<meta property="article:published_time" content="2012-04-25T08:02:36+00:00" />
<meta property="article:modified_time" content="2016-01-19T07:44:41+00:00" />
<meta property="og:site_name" content="Mechatronics Project Site" />
<meta property="og:image" content="/wp-content/uploads/2012/04/pwm2.gif" />
<meta property="og:image:width" content="672" />
<meta property="og:image:height" content="241" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:card" content="summary" />

<!-- Easy FancyBox 1.5.7 using FancyBox 1.3.7 - RavanH (http://status301.net/wordpress-plugins/easy-fancybox/) -->
<script type="text/javascript">
/* <![CDATA[ */
var fb_timeout = null;
var fb_opts = { 'overlayShow' : true, 'hideOnOverlayClick' : true, 'showCloseButton' : true, 'centerOnScroll' : true, 'enableEscapeButton' : true, 'autoScale' : true };
var easy_fancybox_handler = function(){
	/* IMG */
	var fb_IMG_select = 'a[href*=".jpg"]:not(.nofancybox,.pin-it-button), area[href*=".jpg"]:not(.nofancybox), a[href*=".jpeg"]:not(.nofancybox,.pin-it-button), area[href*=".jpeg"]:not(.nofancybox), a[href*=".png"]:not(.nofancybox,.pin-it-button), area[href*=".png"]:not(.nofancybox)';
	jQuery(fb_IMG_select).addClass('fancybox image');
	var fb_IMG_sections = jQuery('div.gallery ');
	fb_IMG_sections.each(function() { jQuery(this).find(fb_IMG_select).attr('rel', 'gallery-' + fb_IMG_sections.index(this)); });
	jQuery('a.fancybox, area.fancybox, li.fancybox a:not(li.nofancybox a)').fancybox( jQuery.extend({}, fb_opts, { 'transitionIn' : 'elastic', 'easingIn' : 'easeOutBack', 'transitionOut' : 'elastic', 'easingOut' : 'easeInBack', 'opacity' : false, 'hideOnContentClick' : false, 'titleShow' : true, 'titlePosition' : 'over', 'titleFromAlt' : true, 'showNavArrows' : true, 'enableKeyboardNav' : true, 'cyclic' : false }) );
	/* Auto-click */ 
	jQuery('#fancybox-auto').trigger('click');
}
/* ]]> */
</script>
</head>

<body class="page-template page-template-sidebar-page page-template-sidebar-page-php page page-id-563 page-child parent-pageid-561 single-author two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="/" rel="home">Mechatronics Project Site</a></span></h1>
				<h2 id="site-description">Group Project Site for SEng466 at the University of Victoria</h2>
			</hgroup>

						<a href="/">
									<img src="/wp-content/uploads/2012/04/cropped-render-1.jpg" width="1000" height="288" alt="Mechatronics Project Site" />
							</a>
			
								<form method="get" id="searchform" action="/">
		<label for="s" class="assistive-text">Search</label>
		<input type="text" class="field" name="s" id="s" placeholder="Search" />
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="Search" />
	</form>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="#content">Skip to primary content</a></div>
												<div class="menu"><ul>
<li ><a href="/">Home</a></li><li class="page_item page-item-12 page_item_has_children"><a href="/project-1/">Project 1</a>
<ul class='children'>
	<li class="page_item page-item-14"><a href="/project-1/setting-up-the-arduino-eclipse-environment-on-mac-os-x-lion/">Arduino Eclipse Development Environment for Mac OS X</a></li>
	<li class="page_item page-item-112"><a href="/project-1/component-based-design-and-process/">Component Oriented Design Process</a></li>
	<li class="page_item page-item-113"><a href="/project-1/control-flow-in-the-hover-station/">Control flow in the Hover Station</a></li>
	<li class="page_item page-item-91"><a href="/project-1/dc-motors/">DC Motors</a></li>
	<li class="page_item page-item-137"><a href="/project-1/source-code/">Full Source Code</a></li>
	<li class="page_item page-item-164"><a href="/project-1/logitech-game-pad/">Logitech Game Pad</a></li>
	<li class="page_item page-item-37"><a href="/project-1/mechanical-design/">Mechanical Design</a></li>
	<li class="page_item page-item-202"><a href="/project-1/project-video/">Project Video</a></li>
	<li class="page_item page-item-83"><a href="/project-1/srf04-sonar/">SRF04 Sonar</a></li>
	<li class="page_item page-item-78"><a href="/project-1/wireless-radio/">Wireless Radio</a></li>
	<li class="page_item page-item-101"><a href="/project-1/working-with-the-brushless-dc-motor/">Working with the Brushless DC Motor</a></li>
</ul>
</li>
<li class="page_item page-item-271 page_item_has_children"><a href="/project-2/">Project 2</a>
<ul class='children'>
	<li class="page_item page-item-301"><a href="/project-2/9-degrees-of-freedom-sensor/">9 Degrees of Freedom Sensor</a></li>
	<li class="page_item page-item-275"><a href="/project-2/esc-calibration-programming/">ESC Calibration &#038; Programming</a></li>
	<li class="page_item page-item-295 page_item_has_children"><a href="/project-2/mechanical-design/">Mechanical Design</a>
	<ul class='children'>
		<li class="page_item page-item-346"><a href="/project-2/mechanical-design/cad-model-and-simulations/">CAD Models and Simulations</a></li>
		<li class="page_item page-item-357"><a href="/project-2/mechanical-design/manufacting-the-parts/">Manufacturing the Parts</a></li>
		<li class="page_item page-item-361"><a href="/project-2/mechanical-design/assembly/">Assembly</a></li>
	</ul>
</li>
	<li class="page_item page-item-506"><a href="/project-2/project-2-demonstration-video/">Project 2 Demonstration Video</a></li>
	<li class="page_item page-item-499"><a href="/project-2/testing-hover-capability/">Testing Hover Capability</a></li>
</ul>
</li>
<li class="page_item page-item-461 page_item_has_children current_page_ancestor"><a href="/project-3/">Project 3</a>
<ul class='children'>
	<li class="page_item page-item-539"><a href="/project-3/project-3-demonstration-videos/">Demonstration Videos</a></li>
	<li class="page_item page-item-677"><a href="/project-3/motor-orientation/">Motor Orientations</a></li>
	<li class="page_item page-item-572"><a href="/project-3/pid-tuning-flight-testing/">PID Tuning &#038; Flight Testing</a></li>
	<li class="page_item page-item-569"><a href="/project-3/possible-improvements/">Possible Improvements</a></li>
	<li class="page_item page-item-561 page_item_has_children current_page_ancestor current_page_parent"><a href="/project-3/quadcopter-software/">Quadcopter Software</a>
	<ul class='children'>
		<li class="page_item page-item-563 current_page_item"><a href="/project-3/quadcopter-software/motor-control/">Motor Speed Control Hook</a></li>
		<li class="page_item page-item-582"><a href="/project-3/quadcopter-software/gamepad-control/">Remote Station &#038; Gamepad Control</a></li>
		<li class="page_item page-item-698"><a href="/project-3/quadcopter-software/setup-video-demonstration/">Setup Video Demonstration</a></li>
		<li class="page_item page-item-580"><a href="/project-3/quadcopter-software/wireless-radio/">Wireless Radio Hook</a></li>
	</ul>
</li>
	<li class="page_item page-item-547"><a href="/project-3/troubleshooting/">Troubleshooting</a></li>
	<li class="page_item page-item-379"><a href="/project-3/wiring-schematic/">Wiring Schematic</a></li>
</ul>
</li>
</ul></div>
			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					
<article id="post-563" class="post-563 page type-page status-publish hentry">
	<header class="entry-header">
		<h1 class="entry-title">Motor Speed Control Hook</h1>
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>Aeroquad comes preconfigured with a variety of different motor controller libraries.  The latest version at the time of writing contains a library that takes advantage of the Uno&#8217;s ATMega 328p onboard Fast PWM mode to send signals to each electronic speed controller (ESC).  Unfortunately after much trial and error, we determined that our configuration did not allow our quadcopter to use this efficient PWM control, requiring us to write a new motor controller library using Arduino&#8217;s Servo.h API.</p>
<h2>ATMega 328p Timers &amp; PWM</h2>
<p>Aeroquad&#8217;s motor controller library efficiently uses the Fast PWM.  The ATMega 328p has 3 timers: timer0, timer1, and timer 2.  Rather than using a software PWM, timer1 and timer2 can be used to control all four motors.  This section will briefly explain how Aeroquad&#8217;s Fast PWM control works.</p>
<p>First, each pin connected to an ESC must be set to output mode. This is done by either using the pinMode() function in Arduino or by modifying the DDRB and DDRD registers as shown below:</p>
<pre class="wp-code-highlight prettyprint">    DDRB = DDRB | B00001110;                                  // Set ports to output PB1-3
    DDRD = DDRD | B00001000;                                  // Set port to output PD3</pre>
<p>The AVR pins are labelled PB0-PB7 (Arduino Pins 0-7) and PD0-PD5 (Arduino Pins 8-13).</p>
<p>Next, timer prescalers must be adjust so that the timers count at a manageable rate for PWM. Aeroquad initializes these timers using the code shown below:</p>
<pre class="wp-code-highlight prettyprint">// Init PWM Timer 1  16 bit
    TCCR1A = (1&amp;lt;</pre>
<p>TCCR1A and TCCR1B are register that can be set according to how timer 1 should function. This configuration causes the timer to use Fast PWM mode and sets a prescaler of 8, meaning that the timer counts up once every 8 ticks of the clock. Timer 1 is also a 16 bit timer, meaning that it can count up to a maximum of 2^16 &#8211; 1. This value, however, is set lower by modifying the ICR1 register.</p>
<p>Similarly, timer 2 is also set to Fast PWM mode. Since it is only an 8-bit timer, it has a maximum value of 255 and, therefore, must count much up much slower. Therefore, timer 2&#8217;s prescaler is set to 256. For more details, read the <a href="/wp-content/uploads/2012/04/ATMega328.pdf" onclick="__gaTracker('send', 'event', 'download', '/wp-content/uploads/2012/04/ATMega328.pdf');">ATMega328 data sheet</a>.</p>
<p>To adjust the PWM frequency using the timers, additional registers must be set. Fast PWM works by setting the pin output to HIGH when the timer begins/overflows at 0 and LOW when it reaches a value set by the OCR registers. This graph demonstrates how this works over time to create a PWM signal.</p>
<div id="attachment_627" style="width: 682px" class="wp-caption alignnone"><a href="/wp-content/uploads/2012/04/pwm2.gif"><img class="size-full wp-image-627" title="Fast PWM" src="/wp-content/uploads/2012/04/pwm2.gif" alt="" width="672" height="241" srcset="/wp-content/uploads/2012/04/pwm2.gif 672w, /wp-content/uploads/2012/04/pwm2-300x107.gif 300w, /wp-content/uploads/2012/04/pwm2-500x179.gif 500w" sizes="(max-width: 672px) 100vw, 672px" /></a><p class="wp-caption-text">Fast PWM. Credit: http://www.arcfn.com/2009/07/secrets-of-arduino-pwm.html</p></div>
<p>This code shows how AeroQuad sets the OCR registers. Each register corresponds to one of the PWM pins on the Arduino board.</p>
<pre class="wp-code-highlight prettyprint">void commandAllMotors(int command) {
    OCR2B = command / 16 ;
    OCR1A = command * 2 ;
    OCR1B = command * 2 ;
    OCR2A = command / 16 ;
}</pre>
<pre class="wp-code-highlight prettyprint">Arduino Pins for each timer
Timer output	Arduino output	AVR Chip pin	Pin name
OC0A		6		12		PD6
OC0B		5		11		PD5
OC1A		9		15		PB1
OC1B		10		16		PB2
OC2A		11		17		PB3
OC2B		3		5		PD3</pre>
<p>For a more in depth explanation of Fast PWM and how to configure it on the Arduino Uno&#8217;s AT Mega 328p processor, read <a href="http://www.arcfn.com/2009/07/secrets-of-arduino-pwm.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.arcfn.com/2009/07/secrets-of-arduino-pwm.html', 'Ken Shirriff&#8217;s blog post on Arduino PWM');">Ken Shirriff&#8217;s blog post on Arduino PWM</a> and skim through sections about each timer in the <a href="/wp-content/uploads/2012/04/ATMega328.pdf" onclick="__gaTracker('send', 'event', 'download', '/wp-content/uploads/2012/04/ATMega328.pdf');">ATMega328 data sheet</a>.</p>
<h2>Radio and Fast PWM Conflict</h2>
<p>Although much less efficient than using Fast PWM, we needed to use a software generated PWM to control the ESCs.  Unfortunately, the <a href="http://www.sparkfun.com/products/705" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.sparkfun.com/products/705', 'nRF24l01 Wireless Radio');">nRF24l01 Wireless Radio</a> used for our copter control requires SPI to communicate with the board, which meant the MOSI pin number 11 was taken.  Since pin 11 is one of the six fast PWM pins available on the Uno, that leaves only fast PWM pins 3, 5, 6, 9, 10 available. Therefore at least one of pins 5 and 6 must be used to accomodate four motors.  This is problematic since the ATMega328 timer0 handles pins 5 and 6, but timer0 is also used for Arduino delay() and millis() functions and Serial communication.  By changing the prescaler of timer0 to slow down the Hertz for fast PWM, serial communication and timing functions used in the Aeroquad software malfunction.</p>
<p>This problem could easily be avoided by using a different Arduino board such as the Seeeduino Mega available in the lab, which has more than three timers.  However, the prototyping shield was already designed to attach to an Arduino Uno.</p>
<h2> Software PWM Aeroquad Hook</h2>
<p>An easy work around to enable other pins for PWM and motor control is to write a software PWM.  From previous projects, we knew that the <a href="http://arduino.cc/en/Reference/Servo" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://arduino.cc/en/Reference/Servo', 'Arduino Servo library');">Arduino Servo library</a> controls some ESCs and brushless motors very well.  Hence, a motor control library using the Servo library replaced the fast PWM motor controller in our software.  This new motor control hook turned out to be quite trivial.  The code for this software hook is shown below.</p>
<pre class="wp-code-highlight prettyprint">/*
  Motors_Servo.h
  AeroQuad motor control using the Arduino Servo library.

  Author: Garrett Owen
 */

#ifndef _AEROQUAD_MOTORS_SERVO_H_
#define _AEROQUAD_MOTORS_SERVO_H_

#include &quot;Arduino.h&quot;
#include &quot;Motors.h&quot;
#include &quot;Servo.h&quot;

Servo motor1;
Servo motor2;
Servo motor3;
Servo motor4;

void initializeMotors(NB_Motors numbers) {
	numberOfMotors = numbers;

	motor1.attach(3);
	motor2.attach(5);
	motor3.attach(6);
	motor4.attach(10);

	commandAllMotors(1000);  // Initialise motors to 1000us (stopped)
}

void writeMotors() {
	motor1.writeMicroseconds(motorCommand[MOTOR1]);
	motor2.writeMicroseconds(motorCommand[MOTOR2]);
	motor3.writeMicroseconds(motorCommand[MOTOR3]);
	motor4.writeMicroseconds(motorCommand[MOTOR4]);
}

void commandAllMotors(int command) {
	motor1.writeMicroseconds(command);
	motor2.writeMicroseconds(command);
	motor3.writeMicroseconds(command);
	motor4.writeMicroseconds(command);
}

#endif</pre>
<p>The basic structure of this library implements the Aeroquad Motors.h prototyped functions. The initializeMotors() function is run at startup, and writeMotors() is used to issue commands to each individual motor. Motor commands are stored in a global array called motorCommand[], which is modified by other AeroQuad libraries.</p>
<p>Since Aeroquad uses a minimum PWM signal of 1000 microseconds and a maximum of 2000 microseconds, the ESCs needed to be re-calibrated to these values. For instructions on how to do this, visit the <a href="/project-2/esc-calibration-programming/">ESC calibration</a> page.</p>
			</div><!-- .entry-content -->
	<footer class="entry-meta">
			</footer><!-- .entry-meta -->
</article><!-- #post-563 -->

						<div id="comments">
	
	
			<h2 id="comments-title">
			5 thoughts on &ldquo;<span>Motor Speed Control Hook</span>&rdquo;		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-2375">
		<article id="comment-2375" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://2.gravatar.com/avatar/b69429b4dde565cb46d22a031f661c5e?s=68&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b69429b4dde565cb46d22a031f661c5e?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Victor</span> on <a href="/project-3/quadcopter-software/motor-control/#comment-2375"><time datetime="2012-07-12T02:36:54+00:00">July 12, 2012 at 2:36 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>hello guys,<br />
I need your help, I&#8217;m working at a project with an octocopter that use parts from Aeroquad. What I have to do is to modify the source code in such way that if a motor fail the octocopter will be able to stay in air without falling or rolling. What file from the source code I have to modify? I&#8217;m kind of new in this Aeroquad software and everything, maybe you can help me.</p>
<p>Thank you</p>
</div>

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-admin bypostauthor odd alt depth-2" id="li-comment-2441">
		<article id="comment-2441" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://0.gravatar.com/avatar/cd53d2655345e21e5a90562da0129a00?s=39&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/cd53d2655345e21e5a90562da0129a00?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">Garrett</span> on <a href="/project-3/quadcopter-software/motor-control/#comment-2441"><time datetime="2012-07-12T20:23:07+00:00">July 12, 2012 at 8:23 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi Victor,<br />
It depends on what kind of Microcontroller you are using (for how to control timers).  For Aeroquad the speed of the PWM signal sent to the electronic speed controllers is managed in Libraries/AQ_Motors/Motors_PWM_Timer.h for newer configurations.</p>
<p>However, you will probably want to modify the Libraries/AQ_FlightControlProcessor/FlightControlOctoX.h file to account for a motor loss.  This sounds like a pretty difficult task.  You&#8217;ll need to find a way to detect a motor failure, and then modify the flight processor calculations to account for the motor failure.  The math behind that is beyond me, but try asking in the forums at aeroquad.com.  Good luck!</p>
</div>

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-16280">
		<article id="comment-16280" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://1.gravatar.com/avatar/42637a8435eeeec86aa4fa98995f5ec6?s=68&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/42637a8435eeeec86aa4fa98995f5ec6?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">mido</span> on <a href="/project-3/quadcopter-software/motor-control/#comment-16280"><time datetime="2013-02-22T23:21:06+00:00">February 22, 2013 at 11:21 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>hi﻿ i am using Speed Controller for Brushless Motor for my quad copter the problem is 3 of them are starting at 60 % and one at 80 % and you know that it must start in the exact time and with the exact speed i need your help in that . thanks.</p>
</div>

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-16288">
		<article id="comment-16288" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://0.gravatar.com/avatar/98ef8795dc8e54ca0978939e84df860c?s=68&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/98ef8795dc8e54ca0978939e84df860c?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Mihai</span> on <a href="/project-3/quadcopter-software/motor-control/#comment-16288"><time datetime="2013-02-23T02:54:09+00:00">February 23, 2013 at 2:54 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hello guys!<br />
I have a BLDC motor equiped with an ESC. There is also an arduino Atmega 328 which I use to generate the pwm signal. I need to feed the ESC with a pwm of a 50 Hz frequency. I don’t know how could I set the exactly 50 Hz frequency. Any ideas? I was searching for two days and…nothing.</p>
</div>

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-17570">
		<article id="comment-17570" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://2.gravatar.com/avatar/80339ccb5dfbdb570f8a4279760a08f8?s=68&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/80339ccb5dfbdb570f8a4279760a08f8?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">nikhil kulkarni</span> on <a href="/project-3/quadcopter-software/motor-control/#comment-17570"><time datetime="2013-03-07T02:51:44+00:00">March 7, 2013 at 2:51 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>hi guys  m making same project n i want circuit dig of remote control of<br />
 quad copter if any 1 have then plz mail me on my id <a href="mailto:bond7843@gmail.com">bond7843@gmail.com</a></p>
</div>

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol>

		
				<p class="nocomments">Comments are closed.</p>
		
	
	
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->

		<div id="secondary" class="widget-area" role="complementary">
			<aside id="nav_menu-5" class="widget widget_nav_menu"><h3 class="widget-title">Project 3 &#8211; Copter Software &#038; Testing</h3><div class="menu-project-3-container"><ul id="menu-project-3" class="menu"><li id="menu-item-464" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-464"><a href="/project-3/">Introduction &#038; Overview</a></li>
<li id="menu-item-686" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-686"><a href="/project-3/motor-orientation/">Motor Orientations</a></li>
<li id="menu-item-576" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor current-menu-ancestor current-menu-parent current-page-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-576"><a href="/project-3/quadcopter-software/">Quadcopter Software</a>
<ul  class="sub-menu">
	<li id="menu-item-577" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-563 current_page_item menu-item-577"><a href="/project-3/quadcopter-software/motor-control/">Motor Speed Control Hook</a></li>
	<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="/project-3/quadcopter-software/wireless-radio/">Wireless Radio Hook</a></li>
	<li id="menu-item-669" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-669"><a href="/project-3/quadcopter-software/gamepad-control/">Remote Station &#038; Gamepad Control</a></li>
	<li id="menu-item-701" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-701"><a href="/project-3/quadcopter-software/setup-video-demonstration/">Software Setup Videos</a></li>
	<li id="menu-item-556" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-556"><a href="https://github.com/2012SEng466/copter" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://github.com/2012SEng466/copter', 'Copter Source Code');">Copter Source Code</a></li>
</ul>
</li>
<li id="menu-item-574" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-574"><a href="/project-3/pid-tuning-flight-testing/">PID Tuning &#038; Flight Testing</a></li>
<li id="menu-item-555" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-555"><a href="/project-3/troubleshooting/">Troubleshooting</a></li>
<li id="menu-item-512" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-512"><a href="/project-3/wiring-schematic/">Wiring Schematic</a></li>
<li id="menu-item-575" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-575"><a href="/project-3/possible-improvements/">Possible Improvements</a></li>
<li id="menu-item-554" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-554"><a href="/project-3/project-3-demonstration-videos/">Flight Videos</a></li>
</ul></div></aside><aside id="nav_menu-4" class="widget widget_nav_menu"><h3 class="widget-title">Project 2 &#8211; Copter Mechanics &#038; Electronics</h3><div class="menu-project-2-container"><ul id="menu-project-2" class="menu"><li id="menu-item-289" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-289"><a href="/project-2/">Introduction &#038; Overview</a></li>
<li id="menu-item-290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-290"><a href="/project-2/esc-calibration-programming/">ESC Calibration &#038; Programming</a></li>
<li id="menu-item-511" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-511"><a href="/project-2/9-degrees-of-freedom-sensor/">9 Degrees of Freedom Sensor</a></li>
<li id="menu-item-367" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-367"><a href="/project-2/mechanical-design/">Mechanical Design</a>
<ul  class="sub-menu">
	<li id="menu-item-370" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-370"><a href="/project-2/mechanical-design/cad-model-and-simulations/">CAD Models and Simulations</a></li>
	<li id="menu-item-369" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-369"><a href="/project-2/mechanical-design/manufacting-the-parts/">Manufacturing the Parts</a></li>
	<li id="menu-item-368" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-368"><a href="/project-2/mechanical-design/assembly/">Assembly</a></li>
</ul>
</li>
<li id="menu-item-510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-510"><a href="/project-2/testing-hover-capability/">Testing Hover Capability</a></li>
<li id="menu-item-509" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-509"><a href="/project-2/project-2-demonstration-video/">Project 2 Demonstration Video</a></li>
</ul></div></aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Project 1</h3><div class="menu-project-1-container"><ul id="menu-project-1" class="menu"><li id="menu-item-238" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-238"><a href="/project-1/">Introduction &#038; Overview</a></li>
<li id="menu-item-237" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-237"><a href="/project-1/setting-up-the-arduino-eclipse-environment-on-mac-os-x-lion/">Development Environment</a></li>
<li id="menu-item-228" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-228"><a href="/project-1/component-based-design-and-process/">Component Oriented Design Process</a></li>
<li id="menu-item-236" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-236"><a href="/project-1/mechanical-design/">Mechanical Design</a></li>
<li id="menu-item-230" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-230"><a href="/project-1/dc-motors/">DC Motors</a>
<ul  class="sub-menu">
	<li id="menu-item-232" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-232"><a href="/project-1/working-with-the-brushless-dc-motor/">Programming the Motor</a></li>
</ul>
</li>
<li id="menu-item-231" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-231"><a href="/project-1/srf04-sonar/">SRF04 Sonar</a></li>
<li id="menu-item-229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-229"><a href="/project-1/control-flow-in-the-hover-station/">Hover Station Control Flow</a></li>
<li id="menu-item-233" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-233"><a href="/project-1/wireless-radio/">Wireless Radios</a></li>
<li id="menu-item-234" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-234"><a href="/project-1/logitech-game-pad/">Logitech Game Pad</a></li>
<li id="menu-item-235" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-235"><a href="/project-1/source-code/">Full Source Code</a></li>
<li id="menu-item-242" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-242"><a href="/project-1/project-video/">Project Video</a></li>
</ul></div></aside>		</div><!-- #secondary .widget-area -->
	<!--WP Code Highlight_start-->
	<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	<script type="text/javascript" src="/wp-content/plugins/wp-code-highlight/js/wp-code-highlight.js"></script>
	<!--WP Code Highlight_end-->

	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			<div id="site-generator">
								<a href="https://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

	<div style="display:none">
	<div class="grofile-hash-map-b69429b4dde565cb46d22a031f661c5e">
	</div>
	<div class="grofile-hash-map-cd53d2655345e21e5a90562da0129a00">
	</div>
	<div class="grofile-hash-map-42637a8435eeeec86aa4fa98995f5ec6">
	</div>
	<div class="grofile-hash-map-98ef8795dc8e54ca0978939e84df860c">
	</div>
	<div class="grofile-hash-map-80339ccb5dfbdb570f8a4279760a08f8">
	</div>
	</div>
<script type='text/javascript' src='/wp-includes/js/comment-reply.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201739'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2017Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/jetpack/modules/wpgroho.js?ver=4.8.2'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='/wp-content/plugins/easy-fancybox/fancybox/jquery.fancybox-1.3.7.min.js?ver=1.5.7'></script>
<script type='text/javascript' src='/wp-content/plugins/easy-fancybox/jquery.easing.pack.js?ver=1.3'></script>
<script type='text/javascript' src='/wp-content/plugins/easy-fancybox/jquery.mousewheel.min.js?ver=3.1.12'></script>
<script type='text/javascript' src='http://stats.wp.com/e-201739.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:3.9.7',blog:'31972707',post:'563',tz:'-7',srv:'robots.dacloughb.com'} ]);
	_stq.push([ 'clickTrackerInit', '31972707', '563' ]);
</script>

<script type="text/javascript">
jQuery(document).on('ready post-load', easy_fancybox_handler );
</script>

</body>
</html>