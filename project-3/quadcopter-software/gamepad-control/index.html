<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) & !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Remote Station &#038; Gamepad Control | Mechatronics Project Site</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="/wp-content/themes/twentyeleven/style.css" />
<link rel="pingback" href="/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s.gravatar.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Mechatronics Project Site &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="Mechatronics Project Site &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Mechatronics Project Site &raquo; Remote Station &#038; Gamepad Control Comments Feed" href="/project-3/quadcopter-software/gamepad-control/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='fancybox-css'  href='/wp-content/plugins/easy-fancybox/fancybox/jquery.fancybox-1.3.7.min.css?ver=1.5.7' type='text/css' media='screen' />
<link rel='stylesheet' id='jetpack_css-css'  href='/wp-content/plugins/jetpack/css/jetpack.css?ver=3.9.7' type='text/css' media='all' />
<!-- This site uses the Google Analytics by Yoast plugin v5.4.6 - Universal enabled - https://yoast.com/wordpress/plugins/google-analytics/ -->
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-28621799-2', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('require', 'displayfeatures');
	__gaTracker('send','pageview');

</script>
<!-- / Google Analytics by Yoast -->
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.2" />
<link rel="canonical" href="/project-3/quadcopter-software/gamepad-control/" />
<link rel='shortlink' href='http://wp.me/P2a9yP-9o' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Fproject-3%2Fquadcopter-software%2Fgamepad-control%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Fproject-3%2Fquadcopter-software%2Fgamepad-control%2F&#038;format=xml" />
<link rel="stylesheet" type="text/css" href="/wp-content/plugins/wp-code-highlight/css/wp-code-highlight.css" media="screen" />

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Remote Station &#038; Gamepad Control" />
<meta property="og:url" content="/project-3/quadcopter-software/gamepad-control/" />
<meta property="og:description" content="In order to control the quadcopter with the Logitech gamepad, a laptop computer was used as an intermediary to take inputs from the controller and send them via serial to the remote station Arduino…" />
<meta property="article:published_time" content="2012-04-25T08:20:13+00:00" />
<meta property="article:modified_time" content="2016-01-19T07:44:41+00:00" />
<meta property="og:site_name" content="Mechatronics Project Site" />
<meta property="og:image" content="/wp-content/uploads/2012/04/Mode-2.jpg" />
<meta property="og:image:width" content="448" />
<meta property="og:image:height" content="492" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:card" content="summary" />

<!-- Easy FancyBox 1.5.7 using FancyBox 1.3.7 - RavanH (http://status301.net/wordpress-plugins/easy-fancybox/) -->
<script type="text/javascript">
/* <![CDATA[ */
var fb_timeout = null;
var fb_opts = { 'overlayShow' : true, 'hideOnOverlayClick' : true, 'showCloseButton' : true, 'centerOnScroll' : true, 'enableEscapeButton' : true, 'autoScale' : true };
var easy_fancybox_handler = function(){
	/* IMG */
	var fb_IMG_select = 'a[href*=".jpg"]:not(.nofancybox,.pin-it-button), area[href*=".jpg"]:not(.nofancybox), a[href*=".jpeg"]:not(.nofancybox,.pin-it-button), area[href*=".jpeg"]:not(.nofancybox), a[href*=".png"]:not(.nofancybox,.pin-it-button), area[href*=".png"]:not(.nofancybox)';
	jQuery(fb_IMG_select).addClass('fancybox image');
	var fb_IMG_sections = jQuery('div.gallery ');
	fb_IMG_sections.each(function() { jQuery(this).find(fb_IMG_select).attr('rel', 'gallery-' + fb_IMG_sections.index(this)); });
	jQuery('a.fancybox, area.fancybox, li.fancybox a:not(li.nofancybox a)').fancybox( jQuery.extend({}, fb_opts, { 'transitionIn' : 'elastic', 'easingIn' : 'easeOutBack', 'transitionOut' : 'elastic', 'easingOut' : 'easeInBack', 'opacity' : false, 'hideOnContentClick' : false, 'titleShow' : true, 'titlePosition' : 'over', 'titleFromAlt' : true, 'showNavArrows' : true, 'enableKeyboardNav' : true, 'cyclic' : false }) );
	/* Auto-click */ 
	jQuery('#fancybox-auto').trigger('click');
}
/* ]]> */
</script>
</head>

<body class="page-template page-template-sidebar-page page-template-sidebar-page-php page page-id-582 page-child parent-pageid-561 single-author two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="/" rel="home">Mechatronics Project Site</a></span></h1>
				<h2 id="site-description">Group Project Site for SEng466 at the University of Victoria</h2>
			</hgroup>

						<a href="/">
									<img src="/wp-content/uploads/2012/04/cropped-render-1.jpg" width="1000" height="288" alt="Mechatronics Project Site" />
							</a>
			
								<form method="get" id="searchform" action="/">
		<label for="s" class="assistive-text">Search</label>
		<input type="text" class="field" name="s" id="s" placeholder="Search" />
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="Search" />
	</form>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="#content">Skip to primary content</a></div>
												<div class="menu"><ul>
<li ><a href="/">Home</a></li><li class="page_item page-item-12 page_item_has_children"><a href="/project-1/">Project 1</a>
<ul class='children'>
	<li class="page_item page-item-14"><a href="/project-1/setting-up-the-arduino-eclipse-environment-on-mac-os-x-lion/">Arduino Eclipse Development Environment for Mac OS X</a></li>
	<li class="page_item page-item-112"><a href="/project-1/component-based-design-and-process/">Component Oriented Design Process</a></li>
	<li class="page_item page-item-113"><a href="/project-1/control-flow-in-the-hover-station/">Control flow in the Hover Station</a></li>
	<li class="page_item page-item-91"><a href="/project-1/dc-motors/">DC Motors</a></li>
	<li class="page_item page-item-137"><a href="/project-1/source-code/">Full Source Code</a></li>
	<li class="page_item page-item-164"><a href="/project-1/logitech-game-pad/">Logitech Game Pad</a></li>
	<li class="page_item page-item-37"><a href="/project-1/mechanical-design/">Mechanical Design</a></li>
	<li class="page_item page-item-202"><a href="/project-1/project-video/">Project Video</a></li>
	<li class="page_item page-item-83"><a href="/project-1/srf04-sonar/">SRF04 Sonar</a></li>
	<li class="page_item page-item-78"><a href="/project-1/wireless-radio/">Wireless Radio</a></li>
	<li class="page_item page-item-101"><a href="/project-1/working-with-the-brushless-dc-motor/">Working with the Brushless DC Motor</a></li>
</ul>
</li>
<li class="page_item page-item-271 page_item_has_children"><a href="/project-2/">Project 2</a>
<ul class='children'>
	<li class="page_item page-item-301"><a href="/project-2/9-degrees-of-freedom-sensor/">9 Degrees of Freedom Sensor</a></li>
	<li class="page_item page-item-275"><a href="/project-2/esc-calibration-programming/">ESC Calibration &#038; Programming</a></li>
	<li class="page_item page-item-295 page_item_has_children"><a href="/project-2/mechanical-design/">Mechanical Design</a>
	<ul class='children'>
		<li class="page_item page-item-346"><a href="/project-2/mechanical-design/cad-model-and-simulations/">CAD Models and Simulations</a></li>
		<li class="page_item page-item-357"><a href="/project-2/mechanical-design/manufacting-the-parts/">Manufacturing the Parts</a></li>
		<li class="page_item page-item-361"><a href="/project-2/mechanical-design/assembly/">Assembly</a></li>
	</ul>
</li>
	<li class="page_item page-item-506"><a href="/project-2/project-2-demonstration-video/">Project 2 Demonstration Video</a></li>
	<li class="page_item page-item-499"><a href="/project-2/testing-hover-capability/">Testing Hover Capability</a></li>
</ul>
</li>
<li class="page_item page-item-461 page_item_has_children current_page_ancestor"><a href="/project-3/">Project 3</a>
<ul class='children'>
	<li class="page_item page-item-539"><a href="/project-3/project-3-demonstration-videos/">Demonstration Videos</a></li>
	<li class="page_item page-item-677"><a href="/project-3/motor-orientation/">Motor Orientations</a></li>
	<li class="page_item page-item-572"><a href="/project-3/pid-tuning-flight-testing/">PID Tuning &#038; Flight Testing</a></li>
	<li class="page_item page-item-569"><a href="/project-3/possible-improvements/">Possible Improvements</a></li>
	<li class="page_item page-item-561 page_item_has_children current_page_ancestor current_page_parent"><a href="/project-3/quadcopter-software/">Quadcopter Software</a>
	<ul class='children'>
		<li class="page_item page-item-563"><a href="/project-3/quadcopter-software/motor-control/">Motor Speed Control Hook</a></li>
		<li class="page_item page-item-582 current_page_item"><a href="/project-3/quadcopter-software/gamepad-control/">Remote Station &#038; Gamepad Control</a></li>
		<li class="page_item page-item-698"><a href="/project-3/quadcopter-software/setup-video-demonstration/">Setup Video Demonstration</a></li>
		<li class="page_item page-item-580"><a href="/project-3/quadcopter-software/wireless-radio/">Wireless Radio Hook</a></li>
	</ul>
</li>
	<li class="page_item page-item-547"><a href="/project-3/troubleshooting/">Troubleshooting</a></li>
	<li class="page_item page-item-379"><a href="/project-3/wiring-schematic/">Wiring Schematic</a></li>
</ul>
</li>
</ul></div>
			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					
<article id="post-582" class="post-582 page type-page status-publish hentry">
	<header class="entry-header">
		<h1 class="entry-title">Remote Station &#038; Gamepad Control</h1>
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>In order to control the quadcopter with the Logitech gamepad, a laptop computer was used as an intermediary to take inputs from the controller and send them via serial to the remote station Arduino. Similarly to Project 1, a simple python script made reading the controller inputs easy.</p>
<h2>Gamepad Python Script</h2>
<p>For copter controls on the gamepad, we used a similar scheme to the one used by Aeroquad for simplicity.  The gamepad controls worked according to this diagram:</p>
<p><a href="/wp-content/uploads/2012/04/Mode-2.jpg"><img class="alignnone size-full wp-image-667" title="Mode 2" src="/wp-content/uploads/2012/04/Mode-2.jpg" alt="" width="448" height="492" srcset="/wp-content/uploads/2012/04/Mode-2.jpg 448w, /wp-content/uploads/2012/04/Mode-2-273x300.jpg 273w" sizes="(max-width: 448px) 100vw, 448px" /></a></p>
<p>Since the throttle movement on the gamepad always returns to center, however, we used the right and left triggers to adjust throttle positions instead of the joystick.  Sometimes the joysticks become stuck slightly in one direction.  To fix this, the python script used a range of values to determine a neutral position.  The script is shown below.</p>
<pre class="wp-code-highlight prettyprint">&#039;&#039;&#039;
basic_control.py
@author: Garrett Owen
@date: April 27, 2012

    for python verson 2.7.1
&#039;&#039;&#039;

import serial
import pygame
import time
import struct

serialPort = &#039;/dev/tty.usbmodemfd1221&#039;       # Arduino Uno
baudRate = 38400

# Open Serial Connection to Arduino Board
ser = serial.Serial(serialPort, baudRate, timeout=1);

&#039;&#039;&#039;
Gets joystick data and prints it
&#039;&#039;&#039;
pygame.init()
#joystick.init()
j = pygame.joystick.Joystick(0)
j.init()
print &#039;Initialized Joystick : %s&#039; % j.get_name()

# Keeps a history of buttons pressed so that one press does
# not send multiple presses to the Arduino Board
axis = [0.0,0.0,0.0,0.0]
throttle = 1000
mode = 1000 # rate mode is &amp;lt; 1500, else it is attitude
aux = 1000

try:
    while True:
        pygame.event.pump()

        # Minimum change in joystick position to send a new command
        diff = 0.005
        if j.get_axis(0) &amp;lt; axis[0] - diff or j.get_axis(0) &amp;gt; axis[0] + diff:
            axis[0] = j.get_axis(0)

        if j.get_axis(2) &amp;lt; axis[2] - diff or j.get_axis(2) &amp;gt; axis[2] + diff:
            axis[2] = j.get_axis(2)

        if j.get_axis(3) &amp;lt; axis[3] - diff or j.get_axis(3) &amp;gt; axis[3] + diff:
            axis[3] = j.get_axis(3)

        # Get Controller Values
        zaxis = axis[0] * 150 + 1500 # Yaw   (z-axis)
        yaxis = axis[3] * -1 * 150 + 1515 # Pitch (y-axis)
        xaxis = axis[2] * 150 + 1500 # Roll  (x-axis)

        # If values are close to neutral set them to 1500
        if zaxis &amp;lt; 1523 and zaxis &amp;gt; 1490:
            zaxis = 1500
        if yaxis &amp;lt; 1495 and yaxis &amp;gt; 1520:
            yaxis = 1500  # temporary fix for rate mode
        if xaxis &amp;lt; 1518 and xaxis &amp;gt; 1481:
            xaxis = 1500  

        # Get throttle position
        # throttle += j.get_axis(1) * -1 * 25 # Throttle
        if j.get_button(4) == 1:
            throttle -= 40
        elif j.get_button(5) == 1:
            throttle += 40
        if j.get_button(6) == 1:
            throttle -= 10
        elif j.get_button(7) == 1:
            throttle += 10

        if throttle &amp;gt; 1700:
            throttle = 1700
        elif throttle &amp;lt; 1000:
            throttle = 1000

        # Calibrate Sensors
        if j.get_button(8) == 1:
            throttle = 1000
            zaxis = 1000
            yaxis = 1000
            xaxis = 2000

        # Arm Motors
        if j.get_button(9) == 1:
            throttle = 1000
            zaxis = 2000

        # Disarm Motors
        if j.get_button(3) == 1:
            throttle = 1000
            zaxis = 1000

        # Change mode
        if j.get_button(0) == 1:
            mode = 1000
        elif j.get_button(1) == 1:
            mode = 2000

        # Turn off motors
        if j.get_button(2) == 1:
            throttle = 1000

        &#039;&#039;&#039;
        Number for each command
        XAXIS &#039;0&#039;
        YAXIS &#039;1&#039;
        ZAXIS &#039;2&#039;
        THROTTLE &#039;3&#039;
        MODE &#039;4&#039;
        AUX &#039;5&#039;
        &#039;&#039;&#039;

        # Put Values into a command string and convert ints to bytes
        command =   &quot;c&quot; + \
                    &quot;;0;&quot; + str(int(round(xaxis))) + \
                    &quot;;1;&quot; + str(int(round(yaxis))) + \
                    &quot;;2;&quot; + str(int(round(zaxis))) + \
                    &quot;;3;&quot; + str(int(round(throttle))) + \
                    &quot;;4;&quot; + str(int(round(mode))) + \
                    &quot;;5;&quot; + str(int(round(aux)))
        print(command)

        # Send Commands
        ser.write(&#039;c&#039;)
        ser.write(&#039;0&#039;);
        ser.write( struct.pack(&#039;h&#039;, int(round(xaxis))) )
        ser.write(&#039;1&#039;);
        ser.write( struct.pack(&#039;h&#039;, int(round(yaxis))) )
        ser.write(&#039;2&#039;);
        ser.write( struct.pack(&#039;h&#039;, int(round(zaxis))) )
        ser.write(&#039;3&#039;);
        ser.write( struct.pack(&#039;h&#039;, int(round(throttle))) )
        ser.write(&#039;4&#039;);
        ser.write( struct.pack(&#039;h&#039;, int(round(mode))) )
        ser.write(&#039;5&#039;);
        ser.write( struct.pack(&#039;h&#039;, int(round(aux))) )

        # Only send 5 times per second
        time.sleep(.2)

except KeyboardInterrupt:
    j.quit()</pre>
<h2>Remote Station</h2>
<p>The remote station only utilized two components: an Arduino Uno and a <a href="http://www.sparkfun.com/products/705" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.sparkfun.com/products/705', 'nRF24l01 Wireless Radio');">nRF24l01 Wireless Radio</a>.  Reading the controller commands as a byte array from a laptop, the remote station simply compiles the controller commands into the radio packet structure and sends it to the quadcopter. In addition to reading controller commands, the remote station can also request the PID values in use from the copter and send updated values.  This process is explained in the section on <a title="PID Tuning &amp; Flight Testing" href="/project-3/pid-tuning-flight-testing/">PID tuning</a>.</p>
<p>Remote station source code:</p>
<pre class="wp-code-highlight prettyprint">

// Do not remove the include below
#include &quot;Aero_Remote.h&quot;

#define XAXIS 0
#define YAXIS 1
#define ZAXIS 2
#define THROTTLE 3
#define MODE 4
#define AUX 5

#define RATE_XAXIS_PID_IDX          0
#define RATE_YAXIS_PID_IDX          1
#define ZAXIS_PID_IDX               2
#define ATTITUDE_XAXIS_PID_IDX      3
#define ATTITUDE_YAXIS_PID_IDX      4
#define HEADING_HOLD_PID_IDX        5
#define ATTITUDE_GYRO_XAXIS_PID_IDX 6
#define ATTITUDE_GYRO_YAXIS_PID_IDX 7
#define ALTITUDE_HOLD_PID_IDX       8
#define ZDAMPENING_PID_IDX          9

int debug = 0;

// Used to read floating point values from the serial port
float readFloatSerial() {
  #define SERIALFLOATSIZE 15
  byte index = 0;
  byte timeout = 0;
  char data[SERIALFLOATSIZE] = &quot;&quot;;

  do {
    if (Serial.available() == 0) {
      delay(10);
      timeout++;
    }
    else {
      data[index] = Serial.read();
      timeout = 0;
      index++;
    }
  } while ((index == 0 || data[index-1] != &#039;;&#039;) &amp;&amp; (timeout &lt; 10) &amp;&amp; (index &lt; sizeof(data)-1));
  data[index] = &#039;\0&#039;;

  return atof(data);
}

/**
 * Waits for timeout*10 milliseconds for Serial data to be available.
 * Return 0 if serial data not available or 1 if it is.
 */
int waitSerialAvailable(int timeout) {
	while ( !Serial.available() ) {
		timeout++;
		if (timeout &gt; timeout) {
			return 0;
		}
		delay(10);
	}
	return 1;
}

// Reads an integer given in bytes
unsigned int readIntSerialBytes() {
	union u_tag {
	    byte b[2];
	    unsigned int iVal;
	} value;

	// Wait for input
	if ( !waitSerialAvailable(10) )
		return -1;

	value.b[0] = Serial.read();

	if ( !waitSerialAvailable(10) )
		return -1;

	value.b[1] = Serial.read();

	return value.iVal;
}

void sendControllerData() {
	radio_packet packet;
	int i, command;

	// Get all values
	for(i = 0; i &lt; 6; i++) {
		if ( !waitSerialAvailable(10) )
			return;

		command = Serial.read() - &#039;0&#039;;

		// Check if it is out of phase
		if (command &lt; 0 || command &gt; 5)
			return;

		switch (command) {
		case XAXIS:
			packet.vars.receiverCommand[0] = readIntSerialBytes();
			break;
		case YAXIS:
			packet.vars.receiverCommand[1] = readIntSerialBytes();
			break;
		case ZAXIS:
			packet.vars.receiverCommand[2] = readIntSerialBytes();
			break;
		case THROTTLE:
			packet.vars.receiverCommand[3] = readIntSerialBytes();
			break;
		case MODE:
			packet.vars.receiverCommand[4] = readIntSerialBytes();
			break;
		case AUX:
			packet.vars.receiverCommand[5] = readIntSerialBytes();
			break;
		default:
			return;
		}
	}

	// This is not a PID calibration packet
	packet.vars.flag = CONTROL_DATA;

	radio_send_wait(&amp;packet, COPTER_ADDR);

	if (debug == 1) {
		for (i = 0; i &lt; 6; i++) {
			Serial.print(packet.vars.receiverCommand[i]);
			Serial.print(&quot; &quot;);
		}
		Serial.println();
	}
}

void sendPidData() {
	float p, i, d, command;
	uint8_t pidIndex;
	radio_packet packet;

	pidIndex = int(readFloatSerial());
	p = readFloatSerial();
	i = readFloatSerial();
	d = readFloatSerial();

	Serial.print(&quot;Index: &quot;);
	Serial.print(pidIndex);
	Serial.print(&quot; P: &quot;);
	Serial.print(p);
	Serial.print(&quot; I: &quot;);
	Serial.print(i);
	Serial.print(&quot; D: &quot;);
	Serial.println(d);

	Serial.println(&quot;Set these values? (y/n)&quot;);
	while (!Serial.available());
	command = Serial.read();
	if (command == &#039;n&#039;) {
		Serial.println(&quot;Calibration canceled.&quot;);

	} else if (command == &#039;y&#039;) {
		// Put data into packet and send
		Serial.println(&quot;Sending values.&quot;);
		packet.vars.pidIndex = pidIndex;
		packet.vars.p = p;
		packet.vars.i = i;
		packet.vars.d = d;
		packet.vars.flag = WRITE_PID;
		radio_send_wait(&amp;packet, COPTER_ADDR);
	}
}

void readPidData(uint8_t pidIndex) {

	radio_packet packet;

	// Request read from index
	packet.vars.pidIndex = pidIndex;
	packet.vars.flag = READ_PID;
	radio_send_wait(&amp;packet, COPTER_ADDR);

	if ( !radio_recv(1000, &amp;packet) ) {
		Serial.println(&quot;No response received.&quot;);
		return;
	}

	// Print PID Data
	Serial.print(&quot;Index: &quot;);
	Serial.print(packet.vars.pidIndex);
	Serial.print(&quot; P: &quot;);
	Serial.print(packet.vars.p);
	Serial.print(&quot; I: &quot;);
	Serial.print(packet.vars.i);
	Serial.print(&quot; D: &quot;);
	Serial.println(packet.vars.d);
}

void commitPid() {
	radio_packet packet;

	Serial.println(&quot;Committing PID values to EEPROM.&quot;);
	packet.vars.flag = COMMIT_PID;
	radio_send_wait(&amp;packet, COPTER_ADDR);
}

//The setup function is called once at startup of the sketch
void setup() {
	Serial.begin(38400);

	// init radio address, channel, payload size
	radio_init(BASE_ADDR, RADIO_CHANNEL, RADIO_PAYLOAD);

}

// The loop function is called in an endless loop
void loop() {
	int command, i;

	if (!Serial.available()) {
		return;
	}

	// What kind of data is to be sent? Read first character.
	if ((command = Serial.read()) == &#039;c&#039;) { 		// send controller commands
		sendControllerData();
	} else if (command == &#039;p&#039;) { 					// set PID
		sendPidData();
	} else if (command == &#039;r&#039;) { 					// read PID
		if ( !waitSerialAvailable(10) )
			return;
		if (Serial.peek() == &#039;a&#039;) { 				// read all PID values
			Serial.read();
			for (i=0; i&lt; 10; i++) {
				delay(20);
				readPidData(i);
			}
			return;
		} else { 									// read specific PID value
			readPidData( int(readFloatSerial()) );
		}
	} else if (command == &#039;s&#039;) { 					// save current PID values to EEPROM
		commitPid();
	} else if (command == &#039;#&#039;) {
		debug = !debug;
	}
}
</pre>
			</div><!-- .entry-content -->
	<footer class="entry-meta">
			</footer><!-- .entry-meta -->
</article><!-- #post-582 -->

						<div id="comments">
	
	
			<h2 id="comments-title">
			3 thoughts on &ldquo;<span>Remote Station &#038; Gamepad Control</span>&rdquo;		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-68609">
		<article id="comment-68609" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://2.gravatar.com/avatar/2c1cf39751c746ee18cb53279cbbc06a?s=68&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/2c1cf39751c746ee18cb53279cbbc06a?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Murat</span> on <a href="/project-3/quadcopter-software/gamepad-control/#comment-68609"><time datetime="2015-04-30T07:43:46+00:00">April 30, 2015 at 7:43 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I Got a syntax error at line 34 &#8230; Is it anything wrong ?</p>
</div>

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='http://www.ooobrand.com/bags/hermes/643.html' rel='external nofollow' class='url'>さらに、20 mmのひもが私の例についての湾曲した開口部を通して自然な合うものではありません。だから私の設計目標は、従来から搭載ストラップを保持するが冗長性と独特のルックスをそ</a></p>
	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='http://www.okakaku.com/brand-1-copy-1-cheap-0-max0-attr0.html' rel='external nofollow' class='url'>経典でCalibre 13R0とCalibre 1315ムーブメントの基礎の上に、ブランパン改善技術、再び自主開発して生産した2種類の高級ムーブメント：めいカレンダーやパワーリザーブ機能のCalibre 13R5、めい</a></p>
	</li><!-- #comment-## -->
		</ol>

		
				<p class="nocomments">Comments are closed.</p>
		
	
	
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->

		<div id="secondary" class="widget-area" role="complementary">
			<aside id="nav_menu-5" class="widget widget_nav_menu"><h3 class="widget-title">Project 3 &#8211; Copter Software &#038; Testing</h3><div class="menu-project-3-container"><ul id="menu-project-3" class="menu"><li id="menu-item-464" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-464"><a href="/project-3/">Introduction &#038; Overview</a></li>
<li id="menu-item-686" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-686"><a href="/project-3/motor-orientation/">Motor Orientations</a></li>
<li id="menu-item-576" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor current-menu-ancestor current-menu-parent current-page-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-576"><a href="/project-3/quadcopter-software/">Quadcopter Software</a>
<ul  class="sub-menu">
	<li id="menu-item-577" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-577"><a href="/project-3/quadcopter-software/motor-control/">Motor Speed Control Hook</a></li>
	<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="/project-3/quadcopter-software/wireless-radio/">Wireless Radio Hook</a></li>
	<li id="menu-item-669" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-582 current_page_item menu-item-669"><a href="/project-3/quadcopter-software/gamepad-control/">Remote Station &#038; Gamepad Control</a></li>
	<li id="menu-item-701" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-701"><a href="/project-3/quadcopter-software/setup-video-demonstration/">Software Setup Videos</a></li>
	<li id="menu-item-556" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-556"><a href="https://github.com/2012SEng466/copter" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://github.com/2012SEng466/copter', 'Copter Source Code');">Copter Source Code</a></li>
</ul>
</li>
<li id="menu-item-574" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-574"><a href="/project-3/pid-tuning-flight-testing/">PID Tuning &#038; Flight Testing</a></li>
<li id="menu-item-555" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-555"><a href="/project-3/troubleshooting/">Troubleshooting</a></li>
<li id="menu-item-512" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-512"><a href="/project-3/wiring-schematic/">Wiring Schematic</a></li>
<li id="menu-item-575" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-575"><a href="/project-3/possible-improvements/">Possible Improvements</a></li>
<li id="menu-item-554" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-554"><a href="/project-3/project-3-demonstration-videos/">Flight Videos</a></li>
</ul></div></aside><aside id="nav_menu-4" class="widget widget_nav_menu"><h3 class="widget-title">Project 2 &#8211; Copter Mechanics &#038; Electronics</h3><div class="menu-project-2-container"><ul id="menu-project-2" class="menu"><li id="menu-item-289" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-289"><a href="/project-2/">Introduction &#038; Overview</a></li>
<li id="menu-item-290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-290"><a href="/project-2/esc-calibration-programming/">ESC Calibration &#038; Programming</a></li>
<li id="menu-item-511" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-511"><a href="/project-2/9-degrees-of-freedom-sensor/">9 Degrees of Freedom Sensor</a></li>
<li id="menu-item-367" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-367"><a href="/project-2/mechanical-design/">Mechanical Design</a>
<ul  class="sub-menu">
	<li id="menu-item-370" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-370"><a href="/project-2/mechanical-design/cad-model-and-simulations/">CAD Models and Simulations</a></li>
	<li id="menu-item-369" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-369"><a href="/project-2/mechanical-design/manufacting-the-parts/">Manufacturing the Parts</a></li>
	<li id="menu-item-368" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-368"><a href="/project-2/mechanical-design/assembly/">Assembly</a></li>
</ul>
</li>
<li id="menu-item-510" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-510"><a href="/project-2/testing-hover-capability/">Testing Hover Capability</a></li>
<li id="menu-item-509" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-509"><a href="/project-2/project-2-demonstration-video/">Project 2 Demonstration Video</a></li>
</ul></div></aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Project 1</h3><div class="menu-project-1-container"><ul id="menu-project-1" class="menu"><li id="menu-item-238" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-238"><a href="/project-1/">Introduction &#038; Overview</a></li>
<li id="menu-item-237" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-237"><a href="/project-1/setting-up-the-arduino-eclipse-environment-on-mac-os-x-lion/">Development Environment</a></li>
<li id="menu-item-228" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-228"><a href="/project-1/component-based-design-and-process/">Component Oriented Design Process</a></li>
<li id="menu-item-236" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-236"><a href="/project-1/mechanical-design/">Mechanical Design</a></li>
<li id="menu-item-230" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-230"><a href="/project-1/dc-motors/">DC Motors</a>
<ul  class="sub-menu">
	<li id="menu-item-232" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-232"><a href="/project-1/working-with-the-brushless-dc-motor/">Programming the Motor</a></li>
</ul>
</li>
<li id="menu-item-231" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-231"><a href="/project-1/srf04-sonar/">SRF04 Sonar</a></li>
<li id="menu-item-229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-229"><a href="/project-1/control-flow-in-the-hover-station/">Hover Station Control Flow</a></li>
<li id="menu-item-233" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-233"><a href="/project-1/wireless-radio/">Wireless Radios</a></li>
<li id="menu-item-234" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-234"><a href="/project-1/logitech-game-pad/">Logitech Game Pad</a></li>
<li id="menu-item-235" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-235"><a href="/project-1/source-code/">Full Source Code</a></li>
<li id="menu-item-242" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-242"><a href="/project-1/project-video/">Project Video</a></li>
</ul></div></aside>		</div><!-- #secondary .widget-area -->
	<!--WP Code Highlight_start-->
	<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	<script type="text/javascript" src="/wp-content/plugins/wp-code-highlight/js/wp-code-highlight.js"></script>
	<!--WP Code Highlight_end-->

	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			<div id="site-generator">
								<a href="https://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

	<div style="display:none">
	<div class="grofile-hash-map-2c1cf39751c746ee18cb53279cbbc06a">
	</div>
	</div>
<script type='text/javascript' src='/wp-includes/js/comment-reply.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201739'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2017Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/jetpack/modules/wpgroho.js?ver=4.8.2'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='/wp-content/plugins/easy-fancybox/fancybox/jquery.fancybox-1.3.7.min.js?ver=1.5.7'></script>
<script type='text/javascript' src='/wp-content/plugins/easy-fancybox/jquery.easing.pack.js?ver=1.3'></script>
<script type='text/javascript' src='/wp-content/plugins/easy-fancybox/jquery.mousewheel.min.js?ver=3.1.12'></script>
<script type='text/javascript' src='http://stats.wp.com/e-201739.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:3.9.7',blog:'31972707',post:'582',tz:'-7',srv:'robots.dacloughb.com'} ]);
	_stq.push([ 'clickTrackerInit', '31972707', '582' ]);
</script>

<script type="text/javascript">
jQuery(document).on('ready post-load', easy_fancybox_handler );
</script>

</body>
</html>